name: Publish Release

on:
  # Listen for version-merged events from version-management workflow
  repository_dispatch:
    types: [version-merged]

concurrency:
  group: publish-${{ github.event.client_payload.data.version }}
  cancel-in-progress: false

jobs:
  publish:
    name: Publish to NPM & Create Release
    uses: NextNodeSolutions/github-actions/.github/workflows/publish-release.yml@main
    with:
      node-version: '20'
      pnpm-version: '10.11.0'
      publish-script: 'changeset:publish'
      build-script: 'build'
      enable-provenance: true
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}